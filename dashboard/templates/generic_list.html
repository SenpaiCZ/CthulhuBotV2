{% extends 'base.html' %}

{% block title %}{{ title }} - CoC Bot{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="display-5 text-success mb-3">{{ title }}</h1>
            <div class="d-flex justify-content-center">
                <div class="col-md-6 col-sm-10">
                    <input type="text" id="searchInput" class="form-control bg-dark text-light border-secondary" placeholder="Search {{ title }}...">
                </div>
            </div>
        </div>
    </div>

    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" id="cardGrid">
        {% if data %}
            {% for key, description in data.items() | sort %}
            <div class="col card-col">
                <div class="card h-100 bg-dark border-secondary">
                    <div class="card-header border-secondary text-success fw-bold">
                        {{ key }}
                    </div>
                    <div class="card-body">
                        <p class="card-text text-light" style="white-space: pre-wrap;">{{ description }}</p>
                    </div>
                    <div class="card-footer border-secondary">
                        <button class="btn btn-sm btn-outline-secondary w-100" onclick="openImageModal('{{ type_slug }}', '{{ key | replace("'", "\\'") }}')">Manage Image</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        {% else %}
            <div class="col-12 text-center text-muted">No items found.</div>
        {% endif %}
    </div>

    <div id="noResults" class="row mt-5 hidden">
        <div class="col-12 text-center text-muted">
            <h4>No results found</h4>
        </div>
    </div>
</div>

<script>
    document.getElementById('searchInput').addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        const cols = document.querySelectorAll('.card-col');
        let hasVisible = false;

        cols.forEach(col => {
            const card = col.querySelector('.card');
            const title = card.querySelector('.card-header').textContent.toLowerCase();
            const text = card.querySelector('.card-text').textContent.toLowerCase();

            if (title.includes(filter) || text.includes(filter)) {
                col.classList.remove('hidden');
                hasVisible = true;
            } else {
                col.classList.add('hidden');
            }
        });

        const noResults = document.getElementById('noResults');
        if (hasVisible) {
            noResults.classList.add('hidden');
        } else {
            noResults.classList.remove('hidden');
        }
    });
</script>

<style>
    .hidden {
        display: none !important;
    }
    .card {
        transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
    }
    .card:hover {
        transform: translateY(-2px);
        border-color: var(--cthulhu-green-main) !important;
        box-shadow: 0 4px 8px rgba(46, 139, 87, 0.2);
    }
</style>
{% endblock %}
