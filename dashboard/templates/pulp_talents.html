{% extends 'base.html' %}

{% block title %}Pulp Talents - CoC Bot{% endblock %}

{% block content %}
<div class="container-fluid dashboard-container">
    <div class="sidebar-panel">
        <div class="card-header bg-dark text-white p-2 text-center border border-secondary border-bottom-0 rounded-top">
            <h5 class="m-0 text-success">Pulp Talents</h5>
        </div>
        <div class="p-2 border border-secondary border-bottom-0 border-top-0 bg-dark">
            <input type="text" id="searchInput" class="form-control form-control-sm bg-secondary text-light border-secondary" placeholder="Search...">
        </div>
        <div class="list-group list-group-flush sidebar-list" id="itemList">
            {% for category, talents in data.items() %}
                <div class="list-group-item bg-dark text-muted small text-uppercase fw-bold border-bottom border-secondary ps-3 py-1">
                    {{ category }}
                </div>
                {% for talent_str in talents %}
                    <!-- We use index + category as ID since names are inside strings -->
                    <button type="button" class="list-group-item list-group-item-action item-list-item"
                            data-category="{{ category }}"
                            data-index="{{ loop.index0 }}"
                            onclick="showItem('{{ category }}', {{ loop.index0 }})">
                        <!-- Simple parse for display label -->
                        {{ talent_str.split('**')[1] if '**' in talent_str else talent_str[:20] }}
                    </button>
                {% endfor %}
            {% endfor %}
        </div>
    </div>

    <div class="detail-panel" id="detailPanel">
        <div id="item-placeholder" class="text-center d-flex flex-column justify-content-center h-100">
            <h2 class="text-muted" style="opacity: 0.3;">Select a talent</h2>
            <p class="text-secondary">View detailed information.</p>
        </div>

        <div id="item-content" class="hidden p-4">
            <!-- Content -->
        </div>
    </div>
</div>

<script>
    document.getElementById('searchInput').addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        const items = document.querySelectorAll('.item-list-item');
        items.forEach(item => {
            const text = item.textContent.toLowerCase();
            if(text.includes(filter)) {
                item.classList.remove('hidden');
            } else {
                item.classList.add('hidden');
            }
        });
    });

    const data = {{ data | tojson }};

    function showItem(category, index) {
        const talentStr = data[category][index];
        if (!talentStr) return;

        // Parse "**Name**: Description"
        const match = talentStr.match(/\*\*(.*?)\*\*:\s*(.*)/);
        const name = match ? match[1] : "Unknown Talent";
        const description = match ? match[2] : talentStr;

        const container = document.getElementById('item-content');
        const placeholder = document.getElementById('item-placeholder');

        // Highlight
        document.querySelectorAll('.item-list-item').forEach(el => {
            if(el.dataset.category === category && parseInt(el.dataset.index) === index) el.classList.add('active');
            else el.classList.remove('active');
        });

        let html = `
            <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                    <h1 class="display-5 mb-0 text-success">${name}</h1>
                    <span class="badge bg-secondary text-uppercase mt-2">${category}</span>
                </div>
            </div>

            <div class="card bg-dark border-secondary">
                <div class="card-body">
                    <p class="card-text text-light">${description}</p>
                </div>
            </div>
        `;

        container.innerHTML = html;
        container.classList.remove('hidden');
        placeholder.style.setProperty('display', 'none', 'important');
        placeholder.classList.remove('d-flex');
    }
</script>
{% endblock %}
