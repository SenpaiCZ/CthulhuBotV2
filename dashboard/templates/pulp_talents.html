{% extends 'base.html' %}

{% block title %}Pulp Talents - CoC Bot{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row mb-4">
        <div class="col-12 text-center">
            <h1 class="display-5 text-success mb-3">Pulp Talents</h1>
            <div class="d-flex justify-content-center">
                <div class="col-md-6 col-sm-10">
                    <input type="text" id="searchInput" class="form-control bg-dark text-light border-secondary" placeholder="Search Talents...">
                </div>
            </div>
        </div>
    </div>

    <div id="talentsContainer">
        {% for category, talents in data.items() %}
        <div class="category-section mb-5">
            <h3 class="text-success border-bottom border-secondary pb-2 mb-4 category-header">{{ category }}</h3>

            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4 card-grid">
                {% for talent_str in talents %}
                    {% set talent = talent_str | parse_pulp_talent %}
                    <div class="col card-col">
                        <div class="card h-100 bg-dark border-secondary">
                            <div class="card-header border-secondary text-success fw-bold">
                                {{ talent.name }}
                            </div>
                            <div class="card-body">
                                <p class="card-text text-light">{{ talent.description }}</p>
                            </div>
                            <div class="card-footer border-secondary">
                                <button class="btn btn-sm btn-outline-secondary w-100" onclick="openImageModal('{{ type_slug }}', '{{ talent.name | replace("'", "\\'") }}')">Manage Image</button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    <div id="noResults" class="row mt-5 hidden">
        <div class="col-12 text-center text-muted">
            <h4>No results found</h4>
        </div>
    </div>
</div>

<script>
    document.getElementById('searchInput').addEventListener('input', function() {
        const filter = this.value.toLowerCase();
        const categories = document.querySelectorAll('.category-section');
        let globalVisible = false;

        categories.forEach(section => {
            const cols = section.querySelectorAll('.card-col');
            let sectionVisible = false;

            cols.forEach(col => {
                const card = col.querySelector('.card');
                const title = card.querySelector('.card-header').textContent.toLowerCase();
                const text = card.querySelector('.card-text').textContent.toLowerCase();

                if (title.includes(filter) || text.includes(filter)) {
                    col.classList.remove('hidden');
                    sectionVisible = true;
                    globalVisible = true;
                } else {
                    col.classList.add('hidden');
                }
            });

            if (sectionVisible) {
                section.classList.remove('hidden');
            } else {
                section.classList.add('hidden');
            }
        });

        const noResults = document.getElementById('noResults');
        if (globalVisible) {
            noResults.classList.add('hidden');
        } else {
            noResults.classList.remove('hidden');
        }
    });
</script>

<style>
    .hidden {
        display: none !important;
    }
    .card {
        transition: transform 0.2s, border-color 0.2s, box-shadow 0.2s;
    }
    .card:hover {
        transform: translateY(-2px);
        border-color: var(--cthulhu-green-main) !important;
        box-shadow: 0 4px 8px rgba(46, 139, 87, 0.2);
    }
</style>
{% endblock %}
